{% extends 'index.html' %}

{% block contenido %}
<div class="section-header">
    <h2>Buscar en OpenLibrary</h2>
</div>

<div class="card" style="margin-bottom: 2rem; padding: 1rem; border: 1px solid #333; border-radius: 8px;">
    <form method="post">
        {% csrf_token %}
        <div style="margin-bottom: 1rem;">
            {{ form.termino.label_tag }}
            {{ form.termino }}
        </div>
        <div style="text-align: center; margin: 0.5rem;"> - O - </div>
        <div style="margin-bottom: 1rem;">
            {{ form.isbn.label_tag }}
            {{ form.isbn }}
        </div>
        <button type="submit">Buscar</button>
    </form>
</div>

{% if resultado %}
<div class="result-single"
    style="border: 1px solid var(--neon-blue); padding: 1rem; border-radius: 8px; margin-bottom: 2rem;">
    <h3>Resultado Exacto (ISBN: {{ resultado.isbn }})</h3>
    <div style="display: flex; gap: 2rem;">
        {% if resultado.cover_url %}
        <img src="{{ resultado.cover_url }}" alt="Portada" style="max-width: 150px; border-radius: 4px;">
        {% endif %}
        <div>
            <p><strong>Título:</strong> {{ resultado.titulo }}</p>
            <p><strong>Páginas:</strong> {{ resultado.paginas }}</p>
            <form method="post" action="{% url 'guardar_libro_api' %}" style="margin-top: 1rem;">
                {% csrf_token %}
                <input type="hidden" name="titulo" value="{{ resultado.titulo }}">
                <!-- Tomamos el primer autor si es lista -->
                <input type="hidden" name="autor" value="{{ resultado.autores.0.name }}">
                <input type="hidden" name="isbn" value="{{ resultado.isbn }}">
                <input type="hidden" name="cover_url" value="{{ resultado.cover_url }}">
                <button type="submit"
                    style="background-color: var(--neon-blue); color: #fff; border: none; padding: 0.5rem 1rem; cursor: pointer;">Guardar
                    en Biblioteca</button>
            </form>
        </div>
    </div>
</div>
{% endif %}

{% if resultados_busqueda %}
<section>
    <h3>Resultados de Búsqueda</h3>
    <table>
        <thead>
            <tr>
                <th>Portada</th>
                <th>Título</th>
                <th>Autor</th>
                <th>Año</th>
                <th>ISBN (aprox)</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for libro in resultados_busqueda %}
            <tr>
                <td>
                    {% if libro.cover_url %}
                    <img src="{{ libro.cover_url }}" alt="Portada" style="max-width: 50px;">
                    {% else %}
                    N/A
                    {% endif %}
                </td>
                <td>{{ libro.titulo }}</td>
                <td>{{ libro.autor }}</td>
                <td>{{ libro.anio }}</td>
                <td>{{ libro.isbn }}</td>
                <td>
                    <form method="post" action="{% url 'guardar_libro_api' %}">
                        {% csrf_token %}
                        <input type="hidden" name="titulo" value="{{ libro.titulo }}">
                        <input type="hidden" name="autor" value="{{ libro.autor }}">
                        <input type="hidden" name="isbn" value="{{ libro.isbn }}">
                        <input type="hidden" name="cover_url" value="{{ libro.cover_url }}">
                        <button type="submit"
                            style="background-color: var(--neon-blue); color: #fff; border: none; padding: 0.5rem; cursor: pointer;">Guardar</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>
{% endif %}

{% endblock %}